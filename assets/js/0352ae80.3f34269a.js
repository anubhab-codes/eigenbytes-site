"use strict";(globalThis.webpackChunkeigenbytes=globalThis.webpackChunkeigenbytes||[]).push([[9355],{435(e,n,s){s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>c,default:()=>a,frontMatter:()=>o,metadata:()=>r,toc:()=>h});const r=JSON.parse('{"id":"devops/Networking/dns","title":"DNS Basics","description":"How names become IP addresses","source":"@site/docs/engineering/devops/03-Networking/dns.md","sourceDirName":"devops/03-Networking","slug":"/devops/Networking/dns","permalink":"/engineering/devops/Networking/dns","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"DNS Basics","toc":{"max_depth":2}},"sidebar":"sidebar","previous":{"title":"User Management in Linux Servers","permalink":"/engineering/devops/Linux/user-access-in-linux-servers"},"next":{"title":"Networking Basics","permalink":"/engineering/devops/Networking/networking-basics"}}');var i=s(4848),l=s(8453);const o={title:"DNS Basics",toc:{max_depth:2}},c="DNS Basics",d={},h=[{value:"How names become IP addresses",id:"how-names-become-ip-addresses",level:2},{value:"The problem (why DNS exists)",id:"the-problem-why-dns-exists",level:2},{value:"Name resolution (the basic idea)",id:"name-resolution-the-basic-idea",level:2},{value:"<code>/etc/hosts</code> (local name resolution)",id:"etchosts-local-name-resolution",level:2},{value:"Why <code>/etc/hosts</code> does not scale",id:"why-etchosts-does-not-scale",level:2},{value:"DNS server (central source of truth)",id:"dns-server-central-source-of-truth",level:2},{value:"<code>/etc/resolv.conf</code> (where Linux looks for DNS)",id:"etcresolvconf-where-linux-looks-for-dns",level:2},{value:"Local override still exists",id:"local-override-still-exists",level:2},{value:"Resolution order (who is asked first)",id:"resolution-order-who-is-asked-first",level:2},{value:"DNS for the internet",id:"dns-for-the-internet",level:2},{value:"Domain names (how names are structured)",id:"domain-names-how-names-are-structured",level:2},{value:"How DNS resolution actually happens",id:"how-dns-resolution-actually-happens",level:2},{value:"Search domains (short names inside organizations)",id:"search-domains-short-names-inside-organizations",level:2},{value:"DNS record types (what DNS stores)",id:"dns-record-types-what-dns-stores",level:2},{value:"A record",id:"a-record",level:3},{value:"AAAA record",id:"aaaa-record",level:3},{value:"CNAME record",id:"cname-record",level:3},{value:"Testing DNS resolution",id:"testing-dns-resolution",level:2},{value:"<code>nslookup</code>",id:"nslookup",level:3},{value:"<code>dig</code>",id:"dig",level:3},{value:"What John understands now",id:"what-john-understands-now",level:2},{value:"Quick cheat sheet",id:"quick-cheat-sheet",level:2}];function t(e){const n={blockquote:"blockquote",br:"br",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,l.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"dns-basics",children:"DNS Basics"})}),"\n",(0,i.jsx)(n.h2,{id:"how-names-become-ip-addresses",children:"How names become IP addresses"}),"\n",(0,i.jsxs)(n.p,{children:["John now has machines talking to each other across networks.",(0,i.jsx)(n.br,{}),"\n","Networking works."]}),"\n",(0,i.jsx)(n.p,{children:"But there is still a problem."}),"\n",(0,i.jsxs)(n.p,{children:["Communicating using ",(0,i.jsx)(n.strong,{children:"IP addresses"})," is painful.",(0,i.jsx)(n.br,{}),"\n","IPs are hard to remember and do not explain what a machine actually does."]}),"\n",(0,i.jsxs)(n.p,{children:["This is where ",(0,i.jsx)(n.strong,{children:"DNS"})," comes in."]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"the-problem-why-dns-exists",children:"The problem (why DNS exists)"}),"\n",(0,i.jsx)(n.p,{children:"John has a database server with this IP:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"\n192.168.1.1\n\n"})}),"\n",(0,i.jsx)(n.p,{children:"He can reach it, but:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"The IP does not say what the machine is"}),"\n",(0,i.jsx)(n.li,{children:"Humans do not remember IPs easily"}),"\n",(0,i.jsx)(n.li,{children:"IPs can change"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"John wants to say:"}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:"\u201cConnect to the database server\u201d"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"not:"}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:"\u201cConnect to 192.168.1.1\u201d"}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"name-resolution-the-basic-idea",children:"Name resolution (the basic idea)"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Name resolution"})," means:"]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:"Converting a name into an IP address"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Example:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"\ndb  \u2192  192.168.1.1\n\n"})}),"\n",(0,i.jsx)(n.p,{children:"Linux always performs name resolution before connecting to a host."}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsxs)(n.h2,{id:"etchosts-local-name-resolution",children:[(0,i.jsx)(n.code,{children:"/etc/hosts"})," (local name resolution)"]}),"\n",(0,i.jsx)(n.p,{children:"John starts with the simplest method."}),"\n",(0,i.jsx)(n.p,{children:"He edits:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"/etc/hosts\n"})}),"\n",(0,i.jsx)(n.p,{children:"Adds:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:"192.168.1.1 db\n"})}),"\n",(0,i.jsx)(n.p,{children:"Now he runs:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"ping db\n"})}),"\n",(0,i.jsx)(n.p,{children:"It works."}),"\n",(0,i.jsxs)(n.p,{children:["Linux replaced ",(0,i.jsx)(n.code,{children:"db"})," with ",(0,i.jsx)(n.code,{children:"192.168.1.1"}),"."]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsxs)(n.h2,{id:"why-etchosts-does-not-scale",children:["Why ",(0,i.jsx)(n.code,{children:"/etc/hosts"})," does not scale"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"/etc/hosts"})," works, but it has serious limitations."]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["It is ",(0,i.jsx)(n.strong,{children:"local"})," to one system"]}),"\n",(0,i.jsx)(n.li,{children:"Another system may use a different name for the same IP"}),"\n",(0,i.jsx)(n.li,{children:"IP changes require updating every machine"}),"\n",(0,i.jsx)(n.li,{children:"Wrong entries can silently break communication"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"This approach works only for:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Very small setups"}),"\n",(0,i.jsx)(n.li,{children:"Temporary test systems"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["For large environments, this ",(0,i.jsx)(n.strong,{children:"does not scale"}),"."]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"dns-server-central-source-of-truth",children:"DNS server (central source of truth)"}),"\n",(0,i.jsxs)(n.p,{children:["Instead of every machine maintaining its own mapping, John introduces a ",(0,i.jsx)(n.strong,{children:"DNS server"}),"."]}),"\n",(0,i.jsx)(n.p,{children:"Now:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"One system stores name \u2192 IP mappings"}),"\n",(0,i.jsx)(n.li,{children:"All hosts query it"}),"\n",(0,i.jsx)(n.li,{children:"Changes are made in one place"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["This becomes the ",(0,i.jsx)(n.strong,{children:"source of truth"}),"."]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsxs)(n.h2,{id:"etcresolvconf-where-linux-looks-for-dns",children:[(0,i.jsx)(n.code,{children:"/etc/resolv.conf"})," (where Linux looks for DNS)"]}),"\n",(0,i.jsxs)(n.p,{children:["Each Linux host must know ",(0,i.jsx)(n.strong,{children:"which DNS server to ask"}),"."]}),"\n",(0,i.jsx)(n.p,{children:"John checks:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"cat /etc/resolv.conf\n"})}),"\n",(0,i.jsx)(n.p,{children:"He adds:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:"nameserver 192.168.1.53\n"})}),"\n",(0,i.jsx)(n.p,{children:"Now:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Every hostname lookup goes to the DNS server"}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"/etc/hosts"})," is no longer the only source"]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"local-override-still-exists",children:"Local override still exists"}),"\n",(0,i.jsxs)(n.p,{children:["Even with DNS configured, ",(0,i.jsx)(n.code,{children:"/etc/hosts"})," still works."]}),"\n",(0,i.jsx)(n.p,{children:"John can add temporary entries:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:"192.168.1.100 temp-db\n"})}),"\n",(0,i.jsx)(n.p,{children:"No DNS change required."}),"\n",(0,i.jsx)(n.p,{children:"This is useful for:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Testing"}),"\n",(0,i.jsx)(n.li,{children:"Temporary servers"}),"\n",(0,i.jsx)(n.li,{children:"Debugging"}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"resolution-order-who-is-asked-first",children:"Resolution order (who is asked first)"}),"\n",(0,i.jsxs)(n.p,{children:["Linux follows an ",(0,i.jsx)(n.strong,{children:"order"})," when resolving names."]}),"\n",(0,i.jsx)(n.p,{children:"That order is defined in:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"/etc/nsswitch.conf\n"})}),"\n",(0,i.jsxs)(n.p,{children:["John checks the ",(0,i.jsx)(n.code,{children:"hosts"})," line:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:"hosts: files dns\n"})}),"\n",(0,i.jsx)(n.p,{children:"Meaning:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Check ",(0,i.jsx)(n.code,{children:"/etc/hosts"})]}),"\n",(0,i.jsx)(n.li,{children:"If not found, query DNS"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"This order can be changed, but the default is sensible."}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"dns-for-the-internet",children:"DNS for the internet"}),"\n",(0,i.jsx)(n.p,{children:"Internal DNS servers cannot resolve internet domains by themselves."}),"\n",(0,i.jsx)(n.p,{children:"To fix this, John configures DNS forwarding."}),"\n",(0,i.jsx)(n.p,{children:"The DNS server forwards unknown requests to public DNS servers like:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"8.8.8.8\n8.8.4.4\n"})}),"\n",(0,i.jsx)(n.p,{children:"Now:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Internal names resolve internally"}),"\n",(0,i.jsx)(n.li,{children:"External names resolve via the internet"}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"domain-names-how-names-are-structured",children:"Domain names (how names are structured)"}),"\n",(0,i.jsx)(n.p,{children:"DNS names are hierarchical."}),"\n",(0,i.jsx)(n.p,{children:"Example:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"apps.google.com\n"})}),"\n",(0,i.jsx)(n.p,{children:"Breakdown:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:".com"})," \u2192 top-level domain"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"google"})," \u2192 domain"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"apps"})," \u2192 subdomain"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Other top-level domains:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:".com"})," \u2192 commercial"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:".net"})," \u2192 network"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:".org"})," \u2192 organization"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:".edu"})," \u2192 education"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:".io"})," \u2192 Indian Ocean territory (popular in tech)"]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"how-dns-resolution-actually-happens",children:"How DNS resolution actually happens"}),"\n",(0,i.jsx)(n.p,{children:"When John accesses:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"apps.google.com\n"})}),"\n",(0,i.jsx)(n.p,{children:"Resolution flow:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Organization DNS checks cache"}),"\n",(0,i.jsx)(n.li,{children:"If not found, asks root DNS"}),"\n",(0,i.jsxs)(n.li,{children:["Root DNS points to ",(0,i.jsx)(n.code,{children:".com"})," DNS"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:".com"})," DNS points to Google DNS"]}),"\n",(0,i.jsxs)(n.li,{children:["Google DNS returns IP for ",(0,i.jsx)(n.code,{children:"apps.google.com"})]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"The result is cached so the next request is faster."}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"search-domains-short-names-inside-organizations",children:"Search domains (short names inside organizations)"}),"\n",(0,i.jsx)(n.p,{children:"Inside John\u2019s company, the database server is named:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"db.mycompany.com\n"})}),"\n",(0,i.jsx)(n.p,{children:"John wants to type:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"ping db\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Linux supports this using ",(0,i.jsx)(n.strong,{children:"search domains"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:["In ",(0,i.jsx)(n.code,{children:"/etc/resolv.conf"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:"search mycompany.com\n"})}),"\n",(0,i.jsx)(n.p,{children:"Now:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"db"})," automatically expands to ",(0,i.jsx)(n.code,{children:"db.mycompany.com"})]}),"\n",(0,i.jsx)(n.li,{children:"Multiple search domains can be configured"}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"dns-record-types-what-dns-stores",children:"DNS record types (what DNS stores)"}),"\n",(0,i.jsx)(n.p,{children:"DNS does not store just one type of record."}),"\n",(0,i.jsx)(n.h3,{id:"a-record",children:"A record"}),"\n",(0,i.jsx)(n.p,{children:"Maps hostname to IPv4 address."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"db.mycompany.com \u2192 192.168.1.1\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h3,{id:"aaaa-record",children:"AAAA record"}),"\n",(0,i.jsx)(n.p,{children:"Maps hostname to IPv6 address."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"db.mycompany.com \u2192 fe80::1\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h3,{id:"cname-record",children:"CNAME record"}),"\n",(0,i.jsx)(n.p,{children:"Creates an alias."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"web.mycompany.com \u2192 app.mycompany.com\n"})}),"\n",(0,i.jsx)(n.p,{children:"Used when:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"One service has multiple names"}),"\n",(0,i.jsx)(n.li,{children:"Backends change, names do not"}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"testing-dns-resolution",children:"Testing DNS resolution"}),"\n",(0,i.jsx)(n.p,{children:"John tests DNS directly."}),"\n",(0,i.jsx)(n.h3,{id:"nslookup",children:(0,i.jsx)(n.code,{children:"nslookup"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"nslookup db.mycompany.com\n"})}),"\n",(0,i.jsxs)(n.p,{children:["This queries DNS servers directly.\nIt ",(0,i.jsxs)(n.strong,{children:["ignores ",(0,i.jsx)(n.code,{children:"/etc/hosts"})]}),"."]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h3,{id:"dig",children:(0,i.jsx)(n.code,{children:"dig"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"dig db.mycompany.com\n"})}),"\n",(0,i.jsx)(n.p,{children:"This provides:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Full DNS response"}),"\n",(0,i.jsx)(n.li,{children:"Useful debugging details"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Preferred tool for troubleshooting."}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"what-john-understands-now",children:"What John understands now"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"IPs are hard to use directly"}),"\n",(0,i.jsx)(n.li,{children:"Name resolution converts names to IPs"}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"/etc/hosts"})," is local and limited"]}),"\n",(0,i.jsx)(n.li,{children:"DNS is centralized and scalable"}),"\n",(0,i.jsx)(n.li,{children:"Resolution order matters"}),"\n",(0,i.jsx)(n.li,{children:"DNS caching improves performance"}),"\n",(0,i.jsx)(n.li,{children:"Search domains simplify internal usage"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["DNS works because ",(0,i.jsx)(n.strong,{children:"everyone agrees on where truth lives"}),"."]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"quick-cheat-sheet",children:"Quick cheat sheet"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Local name mapping\n/etc/hosts\n\n# DNS server config\n/etc/resolv.conf\n\n# Resolution order\n/etc/nsswitch.conf\n\n# Test DNS\nnslookup hostname\ndig hostname\n"})})]})}function a(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(t,{...e})}):t(e)}},8453(e,n,s){s.d(n,{R:()=>o,x:()=>c});var r=s(6540);const i={},l=r.createContext(i);function o(e){const n=r.useContext(l);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),r.createElement(l.Provider,{value:n},e.children)}}}]);