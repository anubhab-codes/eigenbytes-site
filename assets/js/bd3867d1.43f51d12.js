"use strict";(globalThis.webpackChunkeigenbytes=globalThis.webpackChunkeigenbytes||[]).push([[9992],{4926(e,n,i){i.r(n),i.d(n,{assets:()=>o,contentTitle:()=>c,default:()=>a,frontMatter:()=>l,metadata:()=>s,toc:()=>h});const s=JSON.parse('{"id":"devops/version control system/git internals","title":"Git Internals","description":"This article explains Git internals with one goal:","source":"@site/docs/engineering/devops/04-version control system/6 - git internals.md","sourceDirName":"devops/04-version control system","slug":"/devops/version control system/git internals","permalink":"/engineering/devops/version control system/git internals","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":6,"frontMatter":{"title":"Git Internals","toc":{"max_depth":2}},"sidebar":"sidebar","previous":{"title":"Working with GitHub and Pull Requests","permalink":"/engineering/devops/version control system/Working with GitHub and Pull Requests"},"next":{"title":"What is Docker?","permalink":"/engineering/devops/docker/docker-introduction"}}');var r=i(4848),t=i(8453);const l={title:"Git Internals",toc:{max_depth:2}},c="Git Internals (How Git Works Under the Hood)",o={},h=[{value:"The <code>.git</code> directory",id:"the-git-directory",level:2},{value:"Git objects: how Git stores data",id:"git-objects-how-git-stores-data",level:2},{value:"Blob objects (file content)",id:"blob-objects-file-content",level:3},{value:"Tree objects (directory structure)",id:"tree-objects-directory-structure",level:3},{value:"Commit objects (snapshots)",id:"commit-objects-snapshots",level:3},{value:"Why commits are immutable",id:"why-commits-are-immutable",level:2},{value:"Branches: just pointers",id:"branches-just-pointers",level:2},{value:"HEAD: where you are right now",id:"head-where-you-are-right-now",level:2},{value:"Detached HEAD explained",id:"detached-head-explained",level:2},{value:"The staging area (index)",id:"the-staging-area-index",level:2},{value:"The three Git areas (important)",id:"the-three-git-areas-important",level:2},{value:"What <code>git commit</code> really does",id:"what-git-commit-really-does",level:2},{value:"Why rebase rewrites history",id:"why-rebase-rewrites-history",level:2},{value:"Why merge is safe",id:"why-merge-is-safe",level:2},{value:"Why Git can recover lost commits",id:"why-git-can-recover-lost-commits",level:2},{value:"Why Git is fast",id:"why-git-is-fast",level:2},{value:"Why internals matter",id:"why-internals-matter",level:2}];function d(e){const n={br:"br",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"git-internals-how-git-works-under-the-hood",children:"Git Internals (How Git Works Under the Hood)"})}),"\n",(0,r.jsx)(n.p,{children:"This article explains Git internals with one goal:\nmake Git predictable."}),"\n",(0,r.jsxs)(n.p,{children:["You are not expected to memorize commands or file paths.\nYou are expected to understand how Git ",(0,r.jsx)(n.em,{children:"thinks"}),"."]}),"\n",(0,r.jsx)(n.p,{children:"Once this clicks, merge, rebase, reset, and recovery stop feeling scary."}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsxs)(n.h2,{id:"the-git-directory",children:["The ",(0,r.jsx)(n.code,{children:".git"})," directory"]}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:".git"})," directory is the Git repository.\nEverything Git knows about your project lives here."]}),"\n",(0,r.jsxs)(n.p,{children:["Your working directory contains files.\nThe ",(0,r.jsx)(n.code,{children:".git"})," directory contains ",(0,r.jsx)(n.em,{children:"history"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:["If ",(0,r.jsx)(n.code,{children:".git"})," is deleted:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"all commits are lost"}),"\n",(0,r.jsx)(n.li,{children:"all branches are lost"}),"\n",(0,r.jsx)(n.li,{children:"Git cannot recover history"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Your files may still exist,\nbut Git tracking is permanently gone."}),"\n",(0,r.jsxs)(n.p,{children:["Important contents inside ",(0,r.jsx)(n.code,{children:".git"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"objects/"})," \u2192 actual data"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"refs/"})," \u2192 branch pointers"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"HEAD"})," \u2192 current position"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"index"})," \u2192 staging area"]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"git-objects-how-git-stores-data",children:"Git objects: how Git stores data"}),"\n",(0,r.jsx)(n.p,{children:"Git stores everything as objects.\nObjects are immutable."}),"\n",(0,r.jsx)(n.p,{children:"This means:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"objects are never modified"}),"\n",(0,r.jsx)(n.li,{children:"new objects are created instead"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"There are three core object types."}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"blob-objects-file-content",children:"Blob objects (file content)"}),"\n",(0,r.jsxs)(n.p,{children:["A blob stores ",(0,r.jsx)(n.em,{children:"only file content"}),"."]}),"\n",(0,r.jsx)(n.p,{children:"It does not store:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"file name"}),"\n",(0,r.jsx)(n.li,{children:"directory location"}),"\n",(0,r.jsx)(n.li,{children:"permissions"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"If two files have identical content,\nGit stores only one blob."}),"\n",(0,r.jsx)(n.p,{children:"This is why Git is space efficient."}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"tree-objects-directory-structure",children:"Tree objects (directory structure)"}),"\n",(0,r.jsx)(n.p,{children:"A tree represents a directory."}),"\n",(0,r.jsx)(n.p,{children:"A tree maps:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"file names \u2192 blob objects"}),"\n",(0,r.jsx)(n.li,{children:"subdirectories \u2192 other tree objects"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["Trees describe ",(0,r.jsx)(n.em,{children:"structure"}),".\nBlobs describe ",(0,r.jsx)(n.em,{children:"content"}),"."]}),"\n",(0,r.jsx)(n.p,{children:"Together, they represent a snapshot."}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"commit-objects-snapshots",children:"Commit objects (snapshots)"}),"\n",(0,r.jsx)(n.p,{children:"A commit object represents a snapshot in time."}),"\n",(0,r.jsx)(n.p,{children:"A commit contains:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"a pointer to a tree (the snapshot)"}),"\n",(0,r.jsx)(n.li,{children:"parent commit(s)"}),"\n",(0,r.jsx)(n.li,{children:"author and committer information"}),"\n",(0,r.jsx)(n.li,{children:"commit message"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"A commit does not store files.\nIt points to trees, which point to blobs."}),"\n",(0,r.jsx)(n.p,{children:"This indirection is intentional."}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"why-commits-are-immutable",children:"Why commits are immutable"}),"\n",(0,r.jsx)(n.p,{children:"Every Git object is identified by a hash.\nThe hash is calculated from the object content."}),"\n",(0,r.jsx)(n.p,{children:"If anything inside the object changes:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"the hash changes"}),"\n",(0,r.jsx)(n.li,{children:"Git treats it as a new object"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"This guarantees:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"history cannot be silently modified"}),"\n",(0,r.jsx)(n.li,{children:"corruption is detectable"}),"\n",(0,r.jsx)(n.li,{children:"commits are trustworthy"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"This is the foundation of Git safety."}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"branches-just-pointers",children:"Branches: just pointers"}),"\n",(0,r.jsxs)(n.p,{children:["A branch is ",(0,r.jsx)(n.em,{children:"not"})," a copy of code.\nA branch is a pointer to a commit."]}),"\n",(0,r.jsx)(n.p,{children:"When you create a branch:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"no files are duplicated"}),"\n",(0,r.jsx)(n.li,{children:"no commits are copied"}),"\n",(0,r.jsx)(n.li,{children:"only a pointer is created"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"When you commit:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Git creates a new commit object"}),"\n",(0,r.jsx)(n.li,{children:"the current branch pointer moves forward"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Other branches are unaffected."}),"\n",(0,r.jsx)(n.p,{children:"This is why branches are cheap and fast."}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"head-where-you-are-right-now",children:"HEAD: where you are right now"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"HEAD"})," represents your current position."]}),"\n",(0,r.jsx)(n.p,{children:"Usually:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"HEAD"})," \u2192 branch \u2192 commit"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"This means:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"commits move the branch"}),"\n",(0,r.jsx)(n.li,{children:"HEAD follows the branch"}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"detached-head-explained",children:"Detached HEAD explained"}),"\n",(0,r.jsx)(n.p,{children:"Detached HEAD means:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"HEAD points directly to a commit"}),"\n",(0,r.jsx)(n.li,{children:"no branch points to that commit"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"You can:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"inspect files"}),"\n",(0,r.jsx)(n.li,{children:"run builds"}),"\n",(0,r.jsx)(n.li,{children:"experiment safely"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"But:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"new commits will be lost unless you create a branch"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Detached HEAD is safe for inspection,\nnot for long-term work."}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"the-staging-area-index",children:"The staging area (index)"}),"\n",(0,r.jsxs)(n.p,{children:["The staging area is stored in ",(0,r.jsx)(n.code,{children:".git/index"}),".\nIt sits between working directory and repository."]}),"\n",(0,r.jsx)(n.p,{children:"The staging area decides:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"what goes into the next commit"}),"\n",(0,r.jsx)(n.li,{children:"what stays out"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"This allows:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"partial commits"}),"\n",(0,r.jsx)(n.li,{children:"clean commit history"}),"\n",(0,r.jsx)(n.li,{children:"intentional changes"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["Only staged content is committed.\nThis is why ",(0,r.jsx)(n.code,{children:"git add"})," exists."]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"the-three-git-areas-important",children:"The three Git areas (important)"}),"\n",(0,r.jsx)(n.p,{children:"Git always works with three areas:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Working directory",(0,r.jsx)(n.br,{}),"\n","Files you edit."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Staging area (index)",(0,r.jsx)(n.br,{}),"\n","Files prepared for commit."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Repository",(0,r.jsx)(n.br,{}),"\n","Committed history."]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Commands move data between these areas.\nUnderstanding this removes confusion."}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsxs)(n.h2,{id:"what-git-commit-really-does",children:["What ",(0,r.jsx)(n.code,{children:"git commit"})," really does"]}),"\n",(0,r.jsxs)(n.p,{children:["When you run ",(0,r.jsx)(n.code,{children:"git commit"}),":"]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Git reads the staging area"}),"\n",(0,r.jsx)(n.li,{children:"Git creates blob objects if needed"}),"\n",(0,r.jsx)(n.li,{children:"Git creates tree objects"}),"\n",(0,r.jsx)(n.li,{children:"Git creates a commit object"}),"\n",(0,r.jsx)(n.li,{children:"Git moves the branch pointer"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Nothing is overwritten.\nEverything is additive."}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"why-rebase-rewrites-history",children:"Why rebase rewrites history"}),"\n",(0,r.jsxs)(n.p,{children:["Rebase does ",(0,r.jsx)(n.em,{children:"not"})," move commits.\nIt creates new commits."]}),"\n",(0,r.jsx)(n.p,{children:"During rebase:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"original commits are abandoned"}),"\n",(0,r.jsx)(n.li,{children:"new commits are created with new hashes"}),"\n",(0,r.jsx)(n.li,{children:"branch pointer moves to new commits"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Old commits still exist temporarily,\nbut become unreachable."}),"\n",(0,r.jsx)(n.p,{children:"This is why rebasing shared branches is dangerous."}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"why-merge-is-safe",children:"Why merge is safe"}),"\n",(0,r.jsx)(n.p,{children:"A merge commit has multiple parents."}),"\n",(0,r.jsx)(n.p,{children:"This records:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"both histories"}),"\n",(0,r.jsx)(n.li,{children:"where they joined"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Nothing is rewritten.\nNo commit hashes change."}),"\n",(0,r.jsx)(n.p,{children:"Merge preserves reality.\nRebase rewrites the story."}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"why-git-can-recover-lost-commits",children:"Why Git can recover lost commits"}),"\n",(0,r.jsx)(n.p,{children:"Git does not immediately delete objects."}),"\n",(0,r.jsx)(n.p,{children:"Unreachable commits remain until:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"garbage collection runs"}),"\n",(0,r.jsx)(n.li,{children:"retention period expires"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"This is why:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"git reflog"})," can recover mistakes"]}),"\n",(0,r.jsx)(n.li,{children:"accidental resets are often reversible"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Git prefers safety over cleanup."}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"why-git-is-fast",children:"Why Git is fast"}),"\n",(0,r.jsx)(n.p,{children:"Git is fast because:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"operations are local"}),"\n",(0,r.jsx)(n.li,{children:"objects are content-addressed"}),"\n",(0,r.jsx)(n.li,{children:"history is immutable"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Most commands never touch the network."}),"\n",(0,r.jsx)(n.p,{children:"This is why Git scales well."}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"why-internals-matter",children:"Why internals matter"}),"\n",(0,r.jsx)(n.p,{children:"Understanding internals helps you:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"predict Git behavior"}),"\n",(0,r.jsx)(n.li,{children:"choose merge vs rebase correctly"}),"\n",(0,r.jsx)(n.li,{children:"recover from mistakes calmly"}),"\n",(0,r.jsx)(n.li,{children:"stop guessing"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Git is not complex.\nIt is strict."}),"\n",(0,r.jsx)(n.p,{children:"Once the model is clear,\nGit becomes boring \u2014 and that is good."})]})}function a(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},8453(e,n,i){i.d(n,{R:()=>l,x:()=>c});var s=i(6540);const r={},t=s.createContext(r);function l(e){const n=s.useContext(t);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),s.createElement(t.Provider,{value:n},e.children)}}}]);