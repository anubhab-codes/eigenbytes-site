"use strict";(globalThis.webpackChunkeigenbytes=globalThis.webpackChunkeigenbytes||[]).push([[2940],{6498(e,n,a){a.r(n),a.d(n,{assets:()=>d,contentTitle:()=>i,default:()=>h,frontMatter:()=>t,metadata:()=>s,toc:()=>o});const s=JSON.parse('{"id":"devops/docker/volumes-and-data","title":"Containers Are Ephemeral","description":"A container is not a server.","source":"@site/docs/engineering/devops/05-docker/4 - volumes-and-data.md","sourceDirName":"devops/05-docker","slug":"/devops/docker/volumes-and-data","permalink":"/engineering/devops/docker/volumes-and-data","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"title":"Containers Are Ephemeral","toc":{"max_depth":2}},"sidebar":"sidebar","previous":{"title":"Images, Layers, and Dockerfile","permalink":"/engineering/devops/docker/images-layers-and-dockerfile"},"next":{"title":"Docker Networking","permalink":"/engineering/devops/docker/docker-networking"}}');var l=a(4848),r=a(8453);const t={title:"Containers Are Ephemeral",toc:{max_depth:2}},i="Containers Are Ephemeral (Volumes and Data)",d={},o=[{value:"Demonstration: data disappears",id:"demonstration-data-disappears",level:2},{value:"Two ways to persist data",id:"two-ways-to-persist-data",level:2},{value:"Volumes (recommended)",id:"volumes-recommended",level:2},{value:"Use a volume with a container",id:"use-a-volume-with-a-container",level:2},{value:"Bind mounts (for local development)",id:"bind-mounts-for-local-development",level:2},{value:"Volume vs bind mount (simple rule)",id:"volume-vs-bind-mount-simple-rule",level:2},{value:"Cleaning volumes",id:"cleaning-volumes",level:2},{value:"Inspect mounts on a container",id:"inspect-mounts-on-a-container",level:2}];function c(e){const n={code:"code",h1:"h1",h2:"h2",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.header,{children:(0,l.jsx)(n.h1,{id:"containers-are-ephemeral-volumes-and-data",children:"Containers Are Ephemeral (Volumes and Data)"})}),"\n",(0,l.jsx)(n.p,{children:"A container is not a server.\nA container is a process.\nWhen it dies, its writable layer is disposable."}),"\n",(0,l.jsx)(n.p,{children:"If students miss this, they lose data and panic."}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"demonstration-data-disappears",children:"Demonstration: data disappears"}),"\n",(0,l.jsx)(n.p,{children:"Run a container and create a file inside it:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"docker run -it --name temp alpine:latest sh\n"})}),"\n",(0,l.jsx)(n.p,{children:"Inside container:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sh",children:'echo "important" > /data.txt\nls -la /data.txt\nexit\n'})}),"\n",(0,l.jsx)(n.p,{children:"Remove the container:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"docker rm temp\n"})}),"\n",(0,l.jsx)(n.p,{children:"Start a new container:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"docker run -it alpine:latest sh\nls -la /data.txt\n"})}),"\n",(0,l.jsx)(n.p,{children:"What you see:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"file is missing"}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"What this means:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"container writable layer is not durable"}),"\n",(0,l.jsx)(n.li,{children:"new container starts fresh"}),"\n"]}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"two-ways-to-persist-data",children:"Two ways to persist data"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsx)(n.li,{children:"Volumes (managed by Docker)"}),"\n",(0,l.jsx)(n.li,{children:"Bind mounts (map a host folder into the container)"}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"Use volumes for most cases.\nUse bind mounts for local development."}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"volumes-recommended",children:"Volumes (recommended)"}),"\n",(0,l.jsx)(n.p,{children:"Create a volume:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"docker volume create appdata\n"})}),"\n",(0,l.jsx)(n.p,{children:"List volumes:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"docker volume ls\n"})}),"\n",(0,l.jsx)(n.p,{children:"Inspect a volume:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"docker volume inspect appdata\n"})}),"\n",(0,l.jsx)(n.p,{children:"Sample output (short):"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-text",children:'[\n  {\n    "Name": "appdata",\n    "Mountpoint": "/var/lib/docker/volumes/appdata/_data"\n  }\n]\n'})}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"use-a-volume-with-a-container",children:"Use a volume with a container"}),"\n",(0,l.jsx)(n.p,{children:"Write data into the volume:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"docker run --rm -it -v appdata:/data alpine:latest sh\n"})}),"\n",(0,l.jsx)(n.p,{children:"Inside container:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sh",children:'mkdir -p /data/demo\necho "persisted" > /data/demo/value.txt\nls -la /data/demo\nexit\n'})}),"\n",(0,l.jsx)(n.p,{children:"Start a new container with the same volume:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"docker run --rm -it -v appdata:/data alpine:latest sh\ncat /data/demo/value.txt\nexit\n"})}),"\n",(0,l.jsx)(n.p,{children:"What you see:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"the file still exists"}),"\n"]}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"bind-mounts-for-local-development",children:"Bind mounts (for local development)"}),"\n",(0,l.jsx)(n.p,{children:"Create a host folder and file:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:'mkdir -p host-data\necho "from host" > host-data/hello.txt\n'})}),"\n",(0,l.jsx)(n.p,{children:"Run container with bind mount:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:'docker run --rm -it -v "$(pwd)/host-data":/data alpine:latest sh\n'})}),"\n",(0,l.jsx)(n.p,{children:"Inside container:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sh",children:'ls -la /data\ncat /data/hello.txt\necho "from container" > /data/container.txt\nexit\n'})}),"\n",(0,l.jsx)(n.p,{children:"Back on host:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"ls -la host-data\ncat host-data/container.txt\n"})}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"volume-vs-bind-mount-simple-rule",children:"Volume vs bind mount (simple rule)"}),"\n",(0,l.jsx)(n.p,{children:"Volume:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Docker manages location"}),"\n",(0,l.jsx)(n.li,{children:"good for production"}),"\n",(0,l.jsx)(n.li,{children:"avoids hardcoding host paths"}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"Bind mount:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"exact host path"}),"\n",(0,l.jsx)(n.li,{children:"best for development"}),"\n",(0,l.jsx)(n.li,{children:"permissions can bite on Linux"}),"\n"]}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"cleaning-volumes",children:"Cleaning volumes"}),"\n",(0,l.jsx)(n.p,{children:"Delete a specific volume:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"docker volume rm appdata\n"})}),"\n",(0,l.jsx)(n.p,{children:"Remove unused volumes:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"docker volume prune\n"})}),"\n",(0,l.jsx)(n.p,{children:"Be careful:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"prune deletes volumes not used by any container"}),"\n"]}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"inspect-mounts-on-a-container",children:"Inspect mounts on a container"}),"\n",(0,l.jsx)(n.p,{children:"Start a container:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"docker run -d --name voltest -v appdata:/data nginx:alpine\n"})}),"\n",(0,l.jsx)(n.p,{children:"Inspect mounts:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"docker inspect voltest -f '{{json .Mounts}}'\n"})}),"\n",(0,l.jsx)(n.p,{children:"Stop and remove:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"docker rm -f voltest\n"})}),"\n",(0,l.jsx)(n.p,{children:"Data in the volume remains unless you delete the volume."})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(c,{...e})}):c(e)}},8453(e,n,a){a.d(n,{R:()=>t,x:()=>i});var s=a(6540);const l={},r=s.createContext(l);function t(e){const n=s.useContext(r);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:t(e.components),s.createElement(r.Provider,{value:n},e.children)}}}]);