"use strict";(globalThis.webpackChunkeigenbytes=globalThis.webpackChunkeigenbytes||[]).push([[5442],{1933(e,n,s){s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>d,default:()=>t,frontMatter:()=>r,metadata:()=>i,toc:()=>o});const i=JSON.parse('{"id":"devops/docker/images-layers-and-dockerfile","title":"Images, Layers, and Dockerfile","description":"This is the core of Docker.","source":"@site/docs/engineering/devops/05-docker/3 - images-layers-and-dockerfile.md","sourceDirName":"devops/05-docker","slug":"/devops/docker/images-layers-and-dockerfile","permalink":"/engineering/devops/docker/images-layers-and-dockerfile","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"title":"Images, Layers, and Dockerfile","toc":{"max_depth":2}},"sidebar":"sidebar","previous":{"title":"Running Containers","permalink":"/engineering/devops/docker/running-containers"},"next":{"title":"Containers Are Ephemeral","permalink":"/engineering/devops/docker/volumes-and-data"}}');var a=s(4848),l=s(8453);const r={title:"Images, Layers, and Dockerfile",toc:{max_depth:2}},d="Images, Layers, and Dockerfile",c={},o=[{value:"What an image is",id:"what-an-image-is",level:2},{value:"Inspect an image",id:"inspect-an-image",level:2},{value:"Build your first image",id:"build-your-first-image",level:2},{value:"Dockerfile instructions (what they do)",id:"dockerfile-instructions-what-they-do",level:2},{value:"Tagging images",id:"tagging-images",level:2},{value:"Why layer order matters",id:"why-layer-order-matters",level:2},{value:"Build args (simple)",id:"build-args-simple",level:2},{value:"Helpful inspection commands",id:"helpful-inspection-commands",level:2},{value:"Common mistakes",id:"common-mistakes",level:2}];function h(e){const n={code:"code",h1:"h1",h2:"h2",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",ul:"ul",...(0,l.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"images-layers-and-dockerfile",children:"Images, Layers, and Dockerfile"})}),"\n",(0,a.jsx)(n.p,{children:"This is the core of Docker.\nIf students understand this, they can build and ship apps."}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"what-an-image-is",children:"What an image is"}),"\n",(0,a.jsx)(n.p,{children:"An image is a read-only filesystem template.\nIt is built from layers."}),"\n",(0,a.jsx)(n.p,{children:"Each Dockerfile instruction typically creates a new layer.\nLayers are cached.\nThis is why build order matters."}),"\n",(0,a.jsx)(n.p,{children:"Diagram:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"Image\n\u251c\u2500 Layer 1: base (alpine)\n\u251c\u2500 Layer 2: add packages\n\u251c\u2500 Layer 3: copy app\n\u2514\u2500 Layer 4: set command\n"})}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"inspect-an-image",children:"Inspect an image"}),"\n",(0,a.jsx)(n.p,{children:"Pull a base image:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"docker pull alpine:latest\n"})}),"\n",(0,a.jsx)(n.p,{children:"Show image list:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"docker images\n"})}),"\n",(0,a.jsx)(n.p,{children:"Show layer history:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"docker history alpine:latest\n"})}),"\n",(0,a.jsx)(n.p,{children:"Sample output (short):"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-text",children:"IMAGE          CREATED        CREATED BY                      SIZE\n<id>           2 weeks ago    /bin/sh -c #(nop)  CMD ...      0B\n<id>           2 weeks ago    /bin/sh -c #(nop) ADD ...       7MB\n"})}),"\n",(0,a.jsx)(n.p,{children:"What this means:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"images are built step-by-step"}),"\n",(0,a.jsx)(n.li,{children:"each step becomes part of the final image"}),"\n"]}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"build-your-first-image",children:"Build your first image"}),"\n",(0,a.jsx)(n.p,{children:"Create a folder:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"mkdir docker-build-demo\ncd docker-build-demo\n"})}),"\n",(0,a.jsx)(n.p,{children:"Create a file:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'cat > app.sh << \'EOF\'\n#!/bin/sh\necho "Hello from container"\necho "Time: $(date)"\nEOF\nchmod +x app.sh\n'})}),"\n",(0,a.jsx)(n.p,{children:"Create a Dockerfile:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"cat > Dockerfile << 'EOF'\nFROM alpine:latest\nWORKDIR /app\nCOPY app.sh /app/app.sh\nRUN chmod +x /app/app.sh\nCMD [\"/app/app.sh\"]\nEOF\n"})}),"\n",(0,a.jsx)(n.p,{children:"Build:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"docker build -t demo-hello:1.0 .\n"})}),"\n",(0,a.jsx)(n.p,{children:"What you see (sample):"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-text",children:"[+] Building ...\n => [1/4] FROM alpine:latest\n => [2/4] WORKDIR /app\n => [3/4] COPY app.sh /app/app.sh\n => [4/4] RUN chmod +x /app/app.sh\n => naming to demo-hello:1.0\n"})}),"\n",(0,a.jsx)(n.p,{children:"Run it:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"docker run --rm demo-hello:1.0\n"})}),"\n",(0,a.jsx)(n.p,{children:"Sample output:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-text",children:"Hello from container\nTime: Sun Jan 11 06:30:00 UTC 2026\n"})}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"dockerfile-instructions-what-they-do",children:"Dockerfile instructions (what they do)"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"FROM"}),": base image"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"WORKDIR"}),": sets working directory inside image/container"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"COPY"}),": copies files into the image"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"RUN"}),": runs a command at build time (creates a layer)"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"CMD"}),": default command at container runtime"]}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"Short rule:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"RUN"})," happens during build."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"CMD"})," happens during run."]}),"\n"]}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"tagging-images",children:"Tagging images"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"docker images\ndocker tag demo-hello:1.0 demo-hello:latest\n"})}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"why-layer-order-matters",children:"Why layer order matters"}),"\n",(0,a.jsx)(n.p,{children:"Cache is per-layer."}),"\n",(0,a.jsx)(n.p,{children:"If you change a layer, all layers after it rebuild."}),"\n",(0,a.jsx)(n.p,{children:"Practical rule:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"install dependencies first (changes less)"}),"\n",(0,a.jsx)(n.li,{children:"copy app later (changes more)"}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"This saves build time."}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"build-args-simple",children:"Build args (simple)"}),"\n",(0,a.jsx)(n.p,{children:"Update Dockerfile to include:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-Dockerfile",children:"ARG APP_NAME=demo\nENV APP_NAME=$APP_NAME\n"})}),"\n",(0,a.jsx)(n.p,{children:"Build:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"docker build --build-arg APP_NAME=myapp -t demo-hello:2.0 .\n"})}),"\n",(0,a.jsx)(n.p,{children:"Run and print env:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"docker run --rm demo-hello:2.0 sh -c 'echo $APP_NAME'\n"})}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"helpful-inspection-commands",children:"Helpful inspection commands"}),"\n",(0,a.jsx)(n.p,{children:"Metadata:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"docker inspect demo-hello:1.0\n"})}),"\n",(0,a.jsx)(n.p,{children:"Filter one field:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"docker inspect -f '{{.Id}}' demo-hello:1.0\ndocker inspect -f '{{.Config.Cmd}}' demo-hello:1.0\n"})}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"common-mistakes",children:"Common mistakes"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"mixing up build-time vs run-time"}),"\n",(0,a.jsxs)(n.li,{children:["forgetting the final ",(0,a.jsx)(n.code,{children:"."})," in ",(0,a.jsx)(n.code,{children:"docker build ... ."})]}),"\n",(0,a.jsxs)(n.li,{children:["copying large repos into the image without ",(0,a.jsx)(n.code,{children:".dockerignore"})]}),"\n"]})]})}function t(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(h,{...e})}):h(e)}},8453(e,n,s){s.d(n,{R:()=>r,x:()=>d});var i=s(6540);const a={},l=i.createContext(a);function r(e){const n=i.useContext(l);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:r(e.components),i.createElement(l.Provider,{value:n},e.children)}}}]);