"use strict";(globalThis.webpackChunkeigenbytes=globalThis.webpackChunkeigenbytes||[]).push([[524],{8010(e,n,s){s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>h,frontMatter:()=>a,metadata:()=>r,toc:()=>t});const r=JSON.parse('{"id":"devops/docker/docker-internals","title":"Docker Internals","description":"This article explains why containers behave the way they do.","source":"@site/docs/engineering/devops/05-docker/6 -docker-internals.md","sourceDirName":"devops/05-docker","slug":"/devops/docker/docker-internals","permalink":"/engineering/devops/docker/docker-internals","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":6,"frontMatter":{"title":"Docker Internals","toc":{"max_depth":2}},"sidebar":"sidebar","previous":{"title":"Docker Networking","permalink":"/engineering/devops/docker/docker-networking"}}');var i=s(4848),l=s(8453);const a={title:"Docker Internals",toc:{max_depth:2}},o="Docker Internals (Namespaces, Cgroups, and Layers)",c={},t=[{value:"Container = process + isolation",id:"container--process--isolation",level:2},{value:"Namespaces (isolation)",id:"namespaces-isolation",level:2},{value:"Cgroups (resource control)",id:"cgroups-resource-control",level:2},{value:"Image layers and copy-on-write",id:"image-layers-and-copy-on-write",level:2},{value:"Storage drivers (high level)",id:"storage-drivers-high-level",level:2},{value:"Why Docker builds can be slow",id:"why-docker-builds-can-be-slow",level:2},{value:"<code>.dockerignore</code> (build context control)",id:"dockerignore-build-context-control",level:2},{value:"Why internals matter",id:"why-internals-matter",level:2}];function d(e){const n={code:"code",h1:"h1",h2:"h2",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",ul:"ul",...(0,l.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"docker-internals-namespaces-cgroups-and-layers",children:"Docker Internals (Namespaces, Cgroups, and Layers)"})}),"\n",(0,i.jsx)(n.p,{children:"This article explains why containers behave the way they do.\nYou do not need kernel-level depth.\nYou need correct mental models."}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"container--process--isolation",children:"Container = process + isolation"}),"\n",(0,i.jsx)(n.p,{children:"A container is a normal Linux process.\nDocker applies isolation features around it."}),"\n",(0,i.jsx)(n.p,{children:"When the process stops, the container stops."}),"\n",(0,i.jsx)(n.p,{children:"This explains:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"fast start/stop"}),"\n",(0,i.jsx)(n.li,{children:"why logs are stdout/stderr"}),"\n",(0,i.jsx)(n.li,{children:"why containers are not \u201cservers\u201d"}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"namespaces-isolation",children:"Namespaces (isolation)"}),"\n",(0,i.jsx)(n.p,{children:"Linux namespaces isolate what a process can see."}),"\n",(0,i.jsx)(n.p,{children:"Namespaces Docker uses:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"PID namespace: process IDs look separate"}),"\n",(0,i.jsx)(n.li,{children:"NET namespace: networking looks separate"}),"\n",(0,i.jsx)(n.li,{children:"MNT namespace: filesystem mount points look separate"}),"\n",(0,i.jsx)(n.li,{children:"UTS namespace: hostname looks separate"}),"\n",(0,i.jsx)(n.li,{children:"IPC namespace: shared memory segments are separate"}),"\n",(0,i.jsx)(n.li,{children:"USER namespace (optional): user IDs can be mapped"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"What students can observe:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"docker run --rm -it alpine:latest sh\n"})}),"\n",(0,i.jsx)(n.p,{children:"Inside container:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sh",children:"ps\nhostname\nip a\nexit\n"})}),"\n",(0,i.jsx)(n.p,{children:"You will see:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"fewer processes"}),"\n",(0,i.jsx)(n.li,{children:"different hostname"}),"\n",(0,i.jsx)(n.li,{children:"different network interfaces"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"That is namespaces in action."}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"cgroups-resource-control",children:"Cgroups (resource control)"}),"\n",(0,i.jsx)(n.p,{children:"Namespaces isolate.\nCgroups limit."}),"\n",(0,i.jsx)(n.p,{children:"Cgroups control:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"CPU usage"}),"\n",(0,i.jsx)(n.li,{children:"memory usage"}),"\n",(0,i.jsx)(n.li,{children:"IO limits"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Example: limit memory to 100MB:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"docker run --rm -m 100m alpine:latest sh -c 'echo hello'\n"})}),"\n",(0,i.jsx)(n.p,{children:"If an app exceeds memory limit, it can be killed (OOM).\nThis is why memory limits matter in production."}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"image-layers-and-copy-on-write",children:"Image layers and copy-on-write"}),"\n",(0,i.jsx)(n.p,{children:"Images are built from layers.\nEach layer is read-only."}),"\n",(0,i.jsx)(n.p,{children:"A container adds a writable layer on top.\nChanges go into the writable layer."}),"\n",(0,i.jsx)(n.p,{children:"Diagram:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"Container writable layer (changes)\n\u2514\u2500 Image layers (read-only)\n   \u251c\u2500 Layer: app\n   \u251c\u2500 Layer: runtime\n   \u2514\u2500 Layer: base OS\n"})}),"\n",(0,i.jsx)(n.p,{children:"This is why containers are cheap.\nMany containers can share the same image layers."}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"storage-drivers-high-level",children:"Storage drivers (high level)"}),"\n",(0,i.jsxs)(n.p,{children:["Docker uses a storage driver to manage layers.\nCommon on Linux: ",(0,i.jsx)(n.code,{children:"overlay2"}),"."]}),"\n",(0,i.jsx)(n.p,{children:"Check:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"docker info | grep -i 'Storage Driver'\n"})}),"\n",(0,i.jsx)(n.p,{children:"Sample output:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:"Storage Driver: overlay2\n"})}),"\n",(0,i.jsx)(n.p,{children:"You do not need deep driver details for normal usage.\nJust remember: layers are shared and cached."}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"why-docker-builds-can-be-slow",children:"Why Docker builds can be slow"}),"\n",(0,i.jsx)(n.p,{children:"Common reasons:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"big base image"}),"\n",(0,i.jsx)(n.li,{children:"copying huge build context"}),"\n",(0,i.jsx)(n.li,{children:"bad layer ordering (cache misses)"}),"\n",(0,i.jsx)(n.li,{children:"installing packages after copying app (rebuilds too much)"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Fix pattern:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"install dependencies first"}),"\n",(0,i.jsx)(n.li,{children:"copy app last"}),"\n",(0,i.jsxs)(n.li,{children:["use ",(0,i.jsx)(n.code,{children:".dockerignore"})]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsxs)(n.h2,{id:"dockerignore-build-context-control",children:[(0,i.jsx)(n.code,{children:".dockerignore"})," (build context control)"]}),"\n",(0,i.jsx)(n.p,{children:"Docker build sends a \u201ccontext\u201d to the engine.\nIf you send your whole repo, builds slow down."}),"\n",(0,i.jsxs)(n.p,{children:["Create ",(0,i.jsx)(n.code,{children:".dockerignore"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:".git\nnode_modules\ntarget\ndist\n*.log\n"})}),"\n",(0,i.jsx)(n.p,{children:"Then rebuild.\nBuild becomes faster and images become smaller."}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"why-internals-matter",children:"Why internals matter"}),"\n",(0,i.jsx)(n.p,{children:"Internals explain Docker behavior:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"containers stop when the process stops"}),"\n",(0,i.jsx)(n.li,{children:"file changes disappear without volumes"}),"\n",(0,i.jsx)(n.li,{children:"networking is separate per container"}),"\n",(0,i.jsx)(n.li,{children:"CPU/memory limits are enforceable"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Docker is not magic.\nIt is Linux isolation packaged as a tool."})]})}function h(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453(e,n,s){s.d(n,{R:()=>a,x:()=>o});var r=s(6540);const i={},l=r.createContext(i);function a(e){const n=r.useContext(l);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),r.createElement(l.Provider,{value:n},e.children)}}}]);